- name: setup nodejs repo
  ansible.builtin.shell: curl -sL https://rpm.nodesource.com/setup_lts.x | bash

- name: Install nodejs 
  ansible.builtin.yum: 
   name: nodejs 
   state: installed 

- name: add application user 
  ansible.builtin.user:
   name: roboshop 

- name: remove directory app
  ansible.builtin.file:
    path: /app
    state: absent

- name: create directory app
  ansible.builtin.file:
    path: /app
    state: directory


- name:  download app {{component}} content
  ansible.builtin.unarchive:
    src: https://roboshop-artifacts.s3.amazonaws.com/{{component}}.zip 
    dest: /app
    remote_src: yes 

- name: install nodejs dependices 
  community.general.npm:
   path: /app
   state: latest

- name: copy the systemd.service file
  ansible.builtin.copy: 
   src: "{{component}}.service"
   dest: /etc/systemd/system/{{component}}.service 

- name: start {{component}} service 
  ansible.builtin.service: 
   name: "{{component}}"
   daemon_reload: yes
   enabled: yes 
   state: restarted 
  

- name: load schema 
  import_tasks: "{{schema_type}}_schema.yml"
  when: schema_load